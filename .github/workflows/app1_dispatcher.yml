name: "Application A JMeter Dispatcher"

on:
  workflow_dispatch:
    inputs:
      environment_name:
        description: "Select environment"
        required: true
        type: choice
        options:
          - dev
          - staging
          - prod
      jmx_file:
        description: "Select JMeter test plan"
        required: false
        type: choice
        options:
          - sample_jmeter.jmx
          - High_TPS_Runner.jmx
        default: sample_jmeter.jmx
      test_type:
        description: "Choose test type (load/cleanup)"
        required: true
        type: choice
        options:
          - load
          - cleanup
      runners_to_use:
        description: "Number of parallel runners"
        required: true
        type: choice
        options:
          - '1'
          - '2'
          - '3'
          - '4'

jobs:
  dispatch-core:
    uses: ./.github/workflows/core_jmeter_framework.yml
    with:
      app_name: "applicationA"
      environment_name: ${{ github.event.inputs.environment_name }}
      jmx_file: ${{ github.event.inputs.jmx_file }}
      test_type: ${{ github.event.inputs.test_type }}
      runners_to_use: ${{ github.event.inputs.runners_to_use }}

      # Optional app-specific variables, injected from secrets or config
      DURATION: ${{ secrets.APP_A_${{ github.event.inputs.environment_name | upper }}_DURATION }}
      THREADS: ${{ secrets.APP_A_${{ github.event.inputs.environment_name | upper }}_THREADS }}
      RAMPUP: ${{ secrets.APP_A_${{ github.event.inputs.environment_name | upper }}_RAMPUP }}
      AUTH_HEADER: ${{ secrets.APP_A_${{ github.event.inputs.environment_name | upper }}_AUTH_HEADER }}
      API_KEY: ${{ secrets.APP_A_${{ github.event.inputs.environment_name | upper }}_API_KEY }}

    secrets:
      AWS_ACCESS_KEY: ${{ secrets.AWS_APPLICATIONA_DEV_ACCESS_KEY }}
      AWS_SECRET_KEY: ${{ secrets.AWS_APPLICATIONA_DEV_SECRET_KEY }}
